
var ampliturBookingRules = function () {

    // base variables

    /**
     * Eventos
     */

    return {
        routeBookableProducts: null,

        initValidatePassengerHandlers: function (){
            $validatePassengers.off("click", doValidatePassengers);
            $validatePassengers.on("click", doValidatePassengers);
        },    
        processBookableProducts: function (product, group, packageId){
            let productId = product.val();
            let input               = product.find('input');
            var loading             = '<div class="passo__carregando a-centro"><i class="fas fa-pulse fa-spinner fa-2x"></i></div>';
            var passengers          = $('.passo__passageiros-numero').text();
            var factorPassengers    = product.attr('data-fatorpass');
            
            this.resetaPassosAcomodacao();

            if(!this.validatePassengerByFactor(product, passengers, factorPassengers)){
                return;
            }
            
            $('.passo.pacote__servico-principal > .passo__conteudo > .servico-principal__info').remove();
            $('.passo.pacote__servico-principal > .passo__conteudo').append(loading);
    
            $.post(this.routeBookableProducts, {
                grupo: group,
                servprin: productId,
                packageId: packageId,
                numpass: $('#numpass').val(),
            }, function (response) {
                $('.passo.pacote__servico-principal > .passo__conteudo > .passo__carregando').remove();
                $('.passo.pacote__servico-principal > .passo__conteudo').append($(response).hide().fadeIn('fast'));
    
                let observacoes = $(document).find('.pacote-observacoes');
                let target = $(document).find('.pacote__observacoes-roteiro > .pacote__observacoes > .corpo-texto');
    
                target.html(observacoes.html());
                $(document).find('.pacote__observacoes-roteiro').show();
                observacoes.hide();
                bookableOfferHandler();
            });
        },
        resetaPassosAcomodacao(){
            $('.passo.pacote__servico-principal > .passo__conteudo > .servico-principal__info').remove();
            $('.passo.pacote__servico-principal > .passo__conteudo > .servico-principal__detalhes > .servico-principal__info').remove();
            $('.passo.pacote__servicos-adicionais > .passo__conteudo > .passo__servicos-adicionais').html("");
            $('.passo.pacote__servicos-adicionais').hide();
            $('.passo.pacote__formas-pagamento-cupom').hide();
            $('.pacote__observacoes-roteiro').hide();
        },
        processLongtripBookableProducts: function (product){
        },
        validatePassengerByFactor(product, passengers, factorPassengers){
            var passengerFactorMultiple = passengers / factorPassengers;
            var passengerError      = $(document).find('.mensagem--erro-fatorpass');

            passengerError.hide();
    
            if (!(passengerFactorMultiple == 1 || passengerFactorMultiple == passengers)) {
                product.prop('checked', false);
                passengerError.html(passengerError.attr("data-original").replace(":factorPass", factorPassengers));
                passengerError.appendTo(product.parent()).fadeIn('fast');
                return false;
            }
            return true;
        }
    }   // end return
    

    /**
     * Inicialização
     */

    function init() {
        console.log("init");
    }

    init();

};
var bookingRules = new ampliturBookingRules();